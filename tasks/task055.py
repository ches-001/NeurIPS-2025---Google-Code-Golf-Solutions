def p(d,E=enumerate):
 for a,b in[3,4],[1,2]:d=[*zip(*d)];d=[[c or[c,[a,[b,6][8 in C[:i]]][8 in C[i+1:]]][8 in r[:j]and 8 in r[j+1:]]for j,(c,C)in E(zip(r,zip(*d)))]for i,r in E(d)]
 return d