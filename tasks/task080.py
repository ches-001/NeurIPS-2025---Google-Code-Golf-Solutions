def p(d,R=range):H=len(d);D=[H-r.count(0)for r in d if len({*r})==2][0]+1;S=2+(H-D)//D;T=R(-1,2);[(I:=i,J:=j,C:=c)for i in R(1,D-1)for j in R(1,D-1)if(c:=d[i*S][j*S])and sum(0<d[(i+a)*S][(j+b)*S]!=c for a in T for b in T)>3];[d[(i+a)*S+x].__setitem__((j+b)*S+y,d[(I+a)*S][(J+b)*S])for i in R(D)for j in R(D)for a in T for b in T if d[i*S][j*S]==C>0<=i+a<D>j+b>=0 for x in R(S-1)for y in R(S-1)];return d