def p(d,E=enumerate):A,B=zip(*[(i,j)for i,r in E(d) for j,c in E(r)if c]);return[[c or 2*((i in[I:=min(A),X:=max(A)]or j in[J:=min(B),Y:=max(B)]or sum(r[J+1:Y]+[*C[I+1:X]])>1)&(J<=j<=Y>0<I<=i<=X))for j,(c,C)in E(zip(r,zip(*d)))]for i,r in E(d)]